<!DOCTYPE html>
<html lang="en">
    <head>
        <!-- Design by foolishdeveloper.com -->
        <title>Glassmorphism login Form Tutorial in html css</title>
    
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;500;600&display=swap" rel="stylesheet">

        <!--Stylesheet-->
        <link rel="stylesheet" href="./style.css">

    </head>

    <body>
        <form id="loginForm" method="POST" action="/login">
            <h3>Login Here</h3>

            <label for="username">Username</label>
            <input type="text" name="username" id="username" placeholder="Email or Phone" required>

            <label for="password">Password</label>
            <input type="password" name="password" id="password" placeholder="Password" required>

            <button type="submit">Log In</button>
        </form>

        <script>
        // Intercetto il submit per non ricaricare la pagina
        const form = document.getElementById('loginForm');
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const payload = {
            username: form.username.value,
            password: form.password.value
            };
            // Invia in JSON (server ha express.json())
            const res = await fetch('/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
            });

            const data = await res.json();
            if (!res.ok) {
            alert(data.error || 'Login fallito');
            return;
            }
            // Salva il token e chiama una rotta protetta
            localStorage.setItem('token', data.token);

            // Esempio di chiamata autenticata
            const dash = await fetch('/dashboard', {
            headers: { 'Authorization': 'Bearer ' + data.token }
            });
            const dashData = await dash.json();
            alert(dashData.message + ' - utente: ' + dashData.user.username);
            // window.location.href = '/'; // se vuoi andare sulla root protetta
        });
        </script>
    </body>
</html>
